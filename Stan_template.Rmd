---
title: "Stan template"
author: "Sean Raleigh"
date: "July 11, 2015"
output: html_document
---

```{r}
library(knitr)
opts_chunk$set(eval = FALSE)
```

## Using this template

Copy and paste this template to define and run a Stan model.

* Find and replace `yourmodel` with your model name.
* Add data to the data list defined in `data_yourmodel`.
* Specify the Stan model code.
* Indicate parameters to graph in `params_yourmodel`.
* Change layout (if necessary) in the `sample_plots` function call.
* Add extra variables (if necessary) to `rm`.
* When you have a working model, change `final_model` to TRUE.

## Template:

Gather data to pass to Stan:

```{r}
# model name is 'yourmodel'

data_yourmodel <- list()
```

Write Stan model:

```{r}
cat("
    data {
    }
    parameters {
    }
    model {
    }
",
file = "yourmodel.stan")
```

Fit Stan model:

```{r}
final_model = FALSE

if (file.exists("yourmodel.rds") & final_model == TRUE) {
    stan_yourmodel <- readRDS("yourmodel.rds")
} else {
    stan_yourmodel <- stan_model("yourmodel.stan")
    saveRDS(stan_yourmodel, file = "yourmodel.rds")
}

fit_yourmodel <- sampling(stan_yourmodel, data = data_yourmodel)
```

Extract and save samples:

```{r}
samples_yourmodel <- as.data.frame(fit_yourmodel)

write_csv(samples_yourmodel, path = "./yourmodel.csv")

params_yourmodel <- c()
```

Show chain diagnostics and posterior summaries:

```{r, fig.width = 9, fig.height = 10}
traceplot(fit_yourmodel, pars = params_yourmodel, inc_warmup = FALSE)

print(fit_yourmodel)

len <- length(params_yourmodel)
sample_plots(samples_yourmodel,
             params_yourmodel,
             cred_mass = 0.95,
             layout = matrix(c(1:(len + len %% 2)),
                             nrow = (len + len %% 2)/2,
                             ncol = 2))
```

Clean up workspace:

```{r}
cleanup("yourmodel")
rm(final_model, len)
```

```{r}
beep()
```
